services:
  infisical-backend:
    ports:
      # Expose port for localhost access (private environment)
      # Cloudflare access via Caddy still works regardless of this port mapping
      # This allows BOTH access methods:
      # - http://localhost:8020 (direct port mapping)
      # - https://infisical.datacrew.space (via Cloudflare Tunnel â†’ Caddy)
      - 127.0.0.1:8020:8080
    environment:
      # SITE_URL: Use explicit value from .env if set, otherwise default to localhost
      # If INFISICAL_SITE_URL=https://infisical.datacrew.space is set, Cloudflare access works
      # Localhost access still works via port mapping above
      - SITE_URL=${INFISICAL_SITE_URL:-http://localhost:8020}
      # HTTPS_ENABLED: Respect explicit value from .env if set
      # If INFISICAL_HTTPS_ENABLED is not set in .env, default based on SITE_URL:
      # - If SITE_URL is https://, default to true (for Cloudflare)
      # - If SITE_URL is http://localhost, default to false (for localhost)
      # This ensures cookies/sessions work correctly for the configured access method
      # Note: For dual access (localhost + Cloudflare), set INFISICAL_HTTPS_ENABLED=true in .env
      - HTTPS_ENABLED=${INFISICAL_HTTPS_ENABLED:-false}

