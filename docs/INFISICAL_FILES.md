# Infisical File Requirements

This document explains what files are needed for Infisical secret management in this project.

## Required Files for Infisical

### 1. `.env` (Root Directory)
**Purpose**: Main environment file containing all configuration and secrets.

**Infisical-specific variables** (must be in `.env`):
```bash
INFISICAL_ENCRYPTION_KEY=<16-byte-hex-string>
INFISICAL_AUTH_SECRET=<32-byte-base64-string>
INFISICAL_HOSTNAME=:8020  # or infisical.yourdomain.com
INFISICAL_SITE_URL=http://localhost:8020  # or https://infisical.yourdomain.com
INFISICAL_HTTPS_ENABLED=true  # or false for local
```

**Generation commands**:
```bash
# Generate ENCRYPTION_KEY (16-byte hex)
openssl rand -hex 16

# Generate AUTH_SECRET (32-byte base64)
openssl rand -base64 32
```

### 2. `.env.global` (Root Directory)
**Purpose**: Non-sensitive global environment variables shared across services.

**Typical contents**:
```bash
TZ=America/Denver
DOMAIN_NAME=yourdomain.com
```

**Important**: This file is for **non-sensitive** variables only. Sensitive secrets like `INFISICAL_ENCRYPTION_KEY` and `INFISICAL_AUTH_SECRET` should be in `.env`, not here.

The Docker Compose files load both `.env.global` and `.env` (in that order), so variables from `.env` can override `.env.global` values.

### 3. `.infisical.json` (Root Directory)
**Purpose**: Infisical workspace configuration file.

**Contents**:
```json
{
    "workspaceId": "<your-workspace-id>",
    "defaultEnvironment": "",
    "gitBranchToEnvironmentMapping": null
}
```

**How it's created**: Generated by Infisical CLI when you run `infisical init` or configured manually.

## Generated Files (Not Committed to Git)

### `.env.infisical` (Root Directory)
**Purpose**: Auto-generated file containing secrets exported from Infisical.

**How it's created**: Generated by `start_services.py` when using Infisical:
```bash
infisical export --format=dotenv > .env.infisical
```

**Status**:
- ✅ Automatically generated by the system
- ✅ Listed in `.gitignore` (not committed to git)
- ✅ Used by Docker Compose services via `env_file` directive

**Note**: This file is regenerated each time services start, so you should never edit it manually.

## File Loading Order

Docker Compose services load environment files in this order (later files override earlier ones):

1. `.env.global` - Non-sensitive globals
2. `.env` - Main configuration
3. `.env.infisical` - Secrets from Infisical (if using Infisical)

## Quick Setup Checklist

- [ ] Copy `.env_sample` to `.env`
- [ ] Generate `INFISICAL_ENCRYPTION_KEY` and `INFISICAL_AUTH_SECRET`
- [ ] Add Infisical keys to `.env` (NOT `.env.global` - that's for non-sensitive vars only)
- [ ] Create `.infisical.json` (via `infisical init` or manually)
- [ ] Start services: `python start_services.py --profile cpu`
- [ ] Access Infisical UI: `http://localhost:8020/admin/signup`
- [ ] Migrate secrets to Infisical (via UI or CLI)
- [ ] `.env.infisical` will be auto-generated on subsequent starts

## Files NOT Needed

The following files have been removed/consolidated:

- ❌ `.env.example` - Replaced by `.env_sample`
- ❌ `.env.env.bak` - Backup files (now in `.gitignore`)
- ❌ `*.bak`, `*.backup` - All backup files (now in `.gitignore`)

## References

- See `00-infrastructure/docs/INFISICAL_CONFIGURATION.md` for detailed setup
- See `setup/env/README.md` for environment variable documentation
- See `README.md` for quick start guide
